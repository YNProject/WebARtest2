<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Ginza Sakura AR - Final</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" renderer="logarithmicDepthBuffer: true;">
      
      <a-assets>
        <a-mixin id="petal" 
                 geometry="primitive: plane; width: 0.04; height: 0.04" 
                 material="color: #FFB6C1; side: double; shader: flat; transparent: true; opacity: 0.8">
        </a-mixin>
      </a-assets>

      <a-entity camera id="camera">
        </a-entity>

    </a-scene>

    <script>
      const cameraEl = document.querySelector('#camera');
      const petalCount = 100; // 花びらの数（重ければ減らしてください）

      for (let i = 0; i < petalCount; i++) {
        const petal = document.createElement('a-entity');
        petal.setAttribute('mixin', 'petal');
        
        // ランダムな初期位置（前方 -1m 〜 -5m、高さ 0m 〜 4m、左右 -2m 〜 2m）
        const x = (Math.random() - 0.5) * 4;
        const y = Math.random() * 4;
        const z = -Math.random() * 4 - 1;
        petal.setAttribute('position', `${x} ${y} ${z}`);

        // 落下アニメーション
        const fallDuration = 3000 + Math.random() * 4000;
        petal.setAttribute('animation__fall', {
          property: 'position',
          from: `${x} ${y + 2} ${z}`,
          to: `${x + (Math.random() - 0.5)} ${y - 4} ${z}`,
          dur: fallDuration,
          loop: true,
          easing: 'linear'
        });

        // 回転アニメーション
        petal.setAttribute('animation__rotate', {
          property: 'rotation',
          to: `${Math.random() * 360} ${Math.random() * 360} ${Math.random() * 360}`,
          dur: 2000 + Math.random() * 2000,
          loop: true,
          easing: 'linear'
        });

        cameraEl.appendChild(petal);
      }
    </script>
  </body>
</html>